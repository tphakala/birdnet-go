<!doctype html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <title>BirdNET-Go</title>
    <!-- Preload Inter font to prevent FOUT (Flash of Unstyled Text) -->
    <!-- Note: In production, this preload may not match the served path, but the font
         will still load correctly via CSS. This is a minor optimization trade-off. -->
    <link
      rel="preload"
      href="/fonts/Inter-Variable.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <script>
      // Immediately set the theme before any content loads to prevent flash
      (function () {
        const theme = localStorage.getItem('theme') === 'dark' ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', theme);
        document.documentElement.setAttribute('data-theme-controller', theme);
      })();

      // Detect and set initial locale before content loads
      (function () {
        const SUPPORTED_LOCALES = ['en', 'de', 'fr', 'es', 'fi', 'nl', 'pl', 'pt'];
        const DEFAULT_LOCALE = 'en';

        function detectBrowserLocale() {
          if (typeof navigator === 'undefined') {
            return DEFAULT_LOCALE;
          }
          const browserLanguages = navigator.languages || [navigator.language];
          for (const lang of browserLanguages) {
            if (lang) {
              const primaryCode = lang.toLowerCase().split('-')[0];
              if (SUPPORTED_LOCALES.includes(primaryCode)) {
                return primaryCode;
              }
            }
          }
          return DEFAULT_LOCALE;
        }

        let initialLocale = DEFAULT_LOCALE;
        const stored = localStorage.getItem('birdnet-locale');
        if (stored && SUPPORTED_LOCALES.includes(stored)) {
          initialLocale = stored;
        } else {
          initialLocale = detectBrowserLocale();
          try {
            localStorage.setItem('birdnet-locale', initialLocale);
          } catch (e) {
            // Ignore localStorage errors (e.g., private browsing)
          }
        }
        document.documentElement.setAttribute('lang', initialLocale);
      })();
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
