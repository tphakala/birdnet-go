{{define "hostField"}}

<!-- Text input field -->
<div class="form-control relative" x-data="{
    showTooltip: null,
    touched: false,
    fieldId: '{{.id}}{{if .index}}_{{.index}}{{end}}',
    validInput() {
        return this.$refs[this.fieldId] ? this.$refs[this.fieldId].validity.valid : true;
    },
    validHost() {
        const configHost = {{.model}}.replace(/^https?:\/\//, '');
        const currentHost = location.host;
        return configHost === currentHost;
    }
}">

    {{if .label}}
    <!-- Label -->
    <label class="label justify-start" :for="fieldId">
        <span class="label-text capitalize">{{.label}}</span>
        <span class="help-icon" @mouseenter="showTooltip = fieldId"
            @mouseleave="showTooltip = null">â“˜</span>
    </label>
    {{end}}

    <!-- Input field -->
    <input type="text" 
        :id="fieldId"
        name="{{.name}}" 
        x-model="{{.model}}" 
        placeholder="{{with .placeholder}}{{.}}{{end}}"
        class="input input-sm input-bordered {{.class}}" 
        :class="{ 'invalid': touched && !validInput() }"
        :x-ref="fieldId"
        @blur="touched = true"
        {{if .disabled}}x-bind:disabled="{{.disabled}}"{{end}}
        pattern="^(https?:\/\/)?(localhost|([a-zA-Z0-9](-*[a-zA-Z0-9])*\.)+[a-zA-Z]{2,}|(\d{1,3}\.){3}\d{1,3})(:\d{1,5})?$"
        @invalid="touched = true; validHost()" 
        @input="touched = false; validHost()" 
        required 
        maxlength="255"
        aria-required="true"
        aria-invalid="touched && !validInput()"
        :aria-describedby="fieldId + '-error ' + fieldId + '-warning ' + fieldId + '-tooltip'">

    <!-- Validation messages -->
    <span class="text-sm text-red-500" 
        :id="fieldId + '-error'"
        role="alert" 
        aria-live="polite"
        x-show="touched && !validInput()" 
        x-cloak>
        Please enter a valid host address
    </span>
    <span class="text-sm text-red-500" 
        :id="fieldId + '-warning'"
        x-show="!validHost() && validInput()"
        x-cloak>
        Warning: host address does not match the current location "<span x-text="location.host"></span>"
    </span>

    <!-- Tooltip -->
    <div x-show="showTooltip === fieldId" 
        :id="fieldId + '-tooltip'"
        role="tooltip"
        aria-hidden="true"
        x-cloak
        class="tooltip">
        {{.tooltip}}
    </div>
</div>
{{end}}